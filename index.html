---
layout: default
title: Calipso Hub DVD Rental
description: build a DVD Rental Store app within a few hours
isHome: true
---

<section class="bs-docs-section">
	<h1 id="Overview" class="page-header">Overview</h1>
	<p>Sample project demonstrating how to use  <a href="https://github.com/abissgr/calipso-hub">Calipso-Hub</a>
	to build a DVD Rental Store within hours and minimal effort.</p>
</section>
<section class="bs-docs-section">
	<h1 id="build-and-run" class="page-header">Build and Run</h1>
	<p>Follow the steps bellow to build.</p>
	<p>a) Clone the repository:</p>
	{% highlight bash %} git clone https://github.com/manosbatsis/calipso-hub-dvdrental.git {% endhighlight %}
	<p>b) Copy HOWTO.txt to dev.properties:</p>
	{% highlight bash %} cp HOWTO.txt dev.properties {% endhighlight %}
	<p>
		c) Build and install (
		<code>-U</code>
		forces the download of updated snapshot dependencies):
	</p>
	{% highlight bash %} mvn -U clean install {% endhighlight %}
	<p>d) run embedded Jetty container:</p>
	{% highlight bash %} mvn jetty:run {% endhighlight %}
	<p>
		e) Browse the app client: <a href="http://localhost:8080/calipso/client">http://localhost:8080/calipso/client</a> 
		or the API reference: <a href="http://localhost:8080/calipso/apidoc">http://localhost:8080/calipso/apidoc</a>. 
		See also the <a href="#api-reference">Swagger API Reference</a> section bellow.
	</p>
	<p>
		If you are using chrome, ensure you have enabled <a href="http://www.alphadevx.com/a/454-Google-Chrome-and-localhost-cookies">cookies for localhost</a>.
	</p>
	<h2 id="maven_profiles">Maven Profiles</h2>
	<p>
		If have [node](https://nodejs.org) installed, you can use the
		<code>optimize</code>
		profile and
		<code>jetty:run-war</code>
		to optimize client-side code:
	</p>
	{% highlight bash %} mvn -P optimize clean jetty:run-war {% endhighlight %}
	<p>
		To run integration tests simply activate the
		<code>ci</code>
		profile:
	</p>
	{% highlight bash %} mvn -P ci clean install {% endhighlight %}
	<p>
		See also <a href="#tests">Tests</a>.
	</p>
</section>


<section class="bs-docs-section">
	<h1 id="architecture-and-current-status" class="page-header">Architecture and Current Status</h1>
	<h2 id="front-end">Front-end</h2>
	<p>
		The front end is based on backbone marionette and provided by the calipso overlay WAR. Backbone models are the only code pending to provide an administrative SCRUD UI (thanks to calipso's use-case
		driven front-end), unless those models <a href="https://github.com/abissgr/calipso-hub/issues/26">become optional first</a>.
	</p>
	<h2 id="back-end">Back-end</h2>
	<p>
		Most SCRUD endpoints <a href="#api_reference">documented bellow</a> use Controller/Service/Repository classes generated automatically by calipso on startup using <a
			href="http://jboss-javassist.github.io/javassist/">javassist</a>. The small amounts of business logic and custom methods can be found in the few custom components in the code. The larger part of
		the code is simple JPA entity models.
	</p>
	<p>
		The only manually created endpoint is that of <a href="#orders">Orders</a>
	</p>
	<h2 id="tests">Tests</h2>
	<p>
		The
		<code>ci</code>
		POM profile executes integration tests. It does so by utilising <a href="http://maven.apache.org/surefire/maven-failsafe-plugin">maven-failsafe-plugin</a> and <a
			href="http://www.eclipse.org/jetty/documentation/current/jetty-maven-plugin.html">jetty-maven-plugin</a> to start and stop jetty during the
		<code>pre-integration-test</code>
		and
		<code>post-integration-test</code>
		phases respectively. The tests, based on the <a href="https://github.com/rest-assured/rest-assured">rest-assured API</a>, are performed against the live container, i.e. without using any mocks.
	</p>
	<img alt="console output of OrderControllerIT" class="img-responsive" src="{{ site.baseurl }}/assets/images/appinit_tests.png" />
</section>
<section class="bs-docs-section">
	<h1 id="sample-workflow" class="page-header">Sample Workflow</h1>
	<p>Sample workflow of an application client used by clerk on the store counter. The client may have to hold references of objects in memory as indicated in the "notes" since the services API is
		totally stateless. The workflow has three simple steps:</p>
	<ol>
		<li>Scan Client Card</li>
		<li>Scan DVD boxes</li>
		<li>Submit Payment</li>
	</ol>
	<p>The steps are explained in detail within the following sections.</p>
	<table class="table table-striped">
		<thead>
			<th></th>
			<th></th>
		</thead>
	</table>
	<h2 id="scan-client-card">Scan Client Card</h2>
	<p>Scan the 2D barcode of the client card to retrieve the corresponding user:</p>
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Method</th>
				<th>URL</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>GET</td>
				<td>http://localhost:8080/calipso/api/rest/filmInventoryEntries/:userId</td>
			</tr>
		</tbody>
	</table>
	<p>Notes</p>
	<ul>
		<li>The API client is able to authenticate each request (required role: staff or admin)</li>
		<li>The API client must store the user until the end of the workflow (either payment or abort).</li>
	</ul>
	<h2 id="scan-dvd-boxes">Scan DVD boxes</h2>
	<p>Scan the 2D barcode of each physical copy and use the utility "orders" endpoint to get an Order object that includes the appropriate cost for both new and returned rentals</p>
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Method</th>
				<th>URL</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>GET</td>
				<td>http://localhost:8080/calipso/api/rest/order/orders/:filmInventoryEntryId?days</td>
			</tr>
		</tbody>
	</table>
	<p>
		The
		<code>days</code>
		can be used to control the cost for new rentals. The clients state the number of days they intent to rent the inventory entry for and the service calculates the cost according to the pricing
		strategy of the film. The days parameter is ignored for returns, in which case the current date is used to calculate any amount due for late returns.
	</p>
	<p>The returned Order JSON has the following properties.</p>
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Name</th>
				<th>Type</th>
				<th>Description</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>inventoryId</td>
				<td>string</td>
				<td>The UUID of the inventory entry</td>
			</tr>
			<tr>
				<td>filmTitle</td>
				<td>string</td>
				<td>The film title</td>
			</tr>
			<tr>
				<td>filmMpaa</td>
				<td>string</td>
				<td>The film MPAA rating (unrated, G, PG, PG-13, R, NC-17)</td>
			</tr>
			<tr>
				<td>rentalId</td>
				<td>string</td>
				<td>The UUID of the current inventory rental or null if new (i.e. if the inventory entry is available)</td>
			</tr>
			<tr>
				<td>cost</td>
				<td>float</td>
				<td>The initial or pending cost for the inventory entry rental</td>
			</tr>
			<tr>
				<td>days</td>
				<td>int</td>
				<td>The number of days included in the cost according to the clients intent.</td>
			</tr>
			<tr>
				<td>pricingStrategy</td>
				<td>object</td>
				<td>The pricinig strategy, see <a href="#film_pricing_strategies">Film Pricing Strategies</a></td>
			</tr>
		</tbody>
	</table>
	<p>Notes</p>
	<ul>
		<li>The API client is able to authenticate each request (required role: staff or admin)</li>
		<li>The API client can store the entry for use in the next step, update with a new request to adjust the days or discard it at any time (i.e. if the store client changed his mind)</li>
	</ul>
	<h2 id="submit-payment">Submit Payment</h2>
	p>Once ready, the staff can submit the set of orders for payment by submitting a POST request, using an Orders object as the JSON body.
	</p>
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Method</th>
				<th>URL</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>POST</td>
				<td>http://localhost:8080/calipso/api/rest/order/orders</td>
			</tr>
		</tbody>
	</table>
	<p>The returning Payments JSON has the following properties:</p>
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Name</th>
				<th>Type</th>
				<th>Description</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>items</td>
				<td>collection</td>
				<td>The persisted payments (one per inventory rental/return)</td>
			</tr>
			<tr>
				<td>totalCost</td>
				<td>float</td>
				<td>he total cost of enclosed payments</td>
			</tr>
		</tbody>
	</table>
</section>


<section class="bs-docs-section">
	<h1 id="api-reference" class="page-header">Swagger API Reference</h1>
	<p>
		The webapp provides automatically-generated API documentation based on 
		<a href="http://swagger.io/">Swagger</a> and created by <a href="http://springfox.github.io/springfox/">Springfox</a>. To access 
		the documentation run the app and point your browser to <a href="http://localhost:8080/calipso/apidoc">http://localhost:8080/calipso/apidoc</a>.
	</p>
	<img src="{{ site.baseurl }}/assets/images/swagger-ui.png" class="img-responsive" alt="Responsive image">
</section>
<section class="bs-docs-section">
	<h1 id="api-subset-reference" class="page-header">API Overview</h1>
	<p>
		In addition to the complete <a href="#api-reference">reference documentation</a> described above, the following sections document a subset of the services API. 
		The application exposes more endpoints for auth and SCRUD;
		those are "inherited" by the calipso-hub-webapp <a href="http://maven.apache.org/plugins/maven-war-plugin/overlays.html">WAR overlay</a>.
	</p>
	<p>
		With the exception of <a href="#orders">Orders</a>, endpoints are based on code tiers (Controller, Service, Repository) calipso generated using javassist during application initialization.
	</p>
	<h2 id="orders">Orders</h2>
	<p>
		Orders endpoints use DTOs and manually written code to provide the convenient API used in the <a href="#sample_workflow">Sample Workflow</a>.
	</p>
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Action</th>
				<th>Method</th>
				<th>URL</th>
				<th>Request JSON body</th>
				<th>Response JSON body</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>Calculate order</td>
				<td>GET</td>
				<td>http://localhost:8080/calipso/api/rest/order/orders/:filmInventoryEntryId?days</td>
				<td>none</td>
				<td>Order DTO</td>
			</tr>
			<tr>
				<td>Finalize orders</td>
				<td>POST</td>
				<td>http://localhost:8080/calipso/api/rest/order/orders</td>
				<td>Orders DTO</td>
				<td>Payments DTO</td>
			</tr>
		</tbody>
	</table>
	<h2 id="dvd-inventory">DVD Inventory</h2>
	<p>The DVD inventory endpoints refer to the actual physical DVD boxes available for rent by the store.</p>
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Action</th>
				<th>Method</th>
				<th>URL</th>
				<th>Request body</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>Create</td>
				<td>POST</td>
				<td>http://localhost:8080/calipso/api/rest/filmInventoryEntries</td>
				<td>JSON</td>
			</tr>
			<tr>
				<td>Update</td>
				<td>PUT</td>
				<td>http://localhost:8080/calipso/api/rest/filmInventoryEntries</td>
				<td>JSON</td>
			</tr>
			<tr>
				<td>Search</td>
				<td>GET</td>
				<td>http://localhost:8080/calipso/api/rest/filmInventoryEntries?:paramN=valueN</td>
				<td>ignored</td>
			</tr>
		</tbody>
	</table>
	<p>Search parameters:</p>
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Name</th>
				<th>Type</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>id</td>
				<td>UUID string</td>
			</tr>
			<tr>
				<td>film</td>
				<td>UUID string</td>
			</tr>
				<td>film.[any field property name]</td>
				<td>according to the property name</td>
			</tr>
			<tr>
				<td>createdDate</td>
				<td>timestamp</td>
			</tr>
			<tr>
				<td>lastModifiedBy</td>
				<td>UUID string</td>
			</tr>
			<tr>
				<td>lastModifiedDate</td>
				<td>timestamp</td>
			</tr>
		</tbody>
	</table>
	<h2 id="films">Films</h2>
	<p>The film endpoints refer to films in the general sense of audio/visual production titles.</p>
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Action</th>
				<th>Method</th>
				<th>URL</th>
				<th>Request body</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>Create</td>
				<td>POST</td>
				<td>http://localhost:8080/calipso/api/rest/films</td>
				<td>JSON</td>
			</tr>
			<tr>
				<td>Update</td>
				<td>PUT</td>
				<td>http://localhost:8080/calipso/api/rest/films</td>
				<td>JSON</td>
			</tr>
			<tr>
				<td>Search</td>
				<td>GET</td>
				<td>http://localhost:8080/calipso/api/rest/films?:paramN=valueN</td>
				<td>ignored</td>
			</tr>
		</tbody>
	</table>
	<p>Search parameters:</p>
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Name</th>
				<th>Type</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>id</td>
				<td>UUID string</td>
			</tr>
			<tr>
				<td>title</td>
				<td>string (‘%’ is a “like” wildcard)</td>
			</tr>
			<tr>
				<td>description</td>
				<td>string (‘%’ is a “like” wildcard)</td>
			</tr>
			<tr>
				<td>mpaaRating</td>
				<td>enum, one of: unrated, G, PG, PG-13, R, NC-17</td>
			</tr>
			<tr>
				<td>createdBy</td>
				<td>UUID string</td>
			</tr>
			<tr>
				<td>createdDate</td>
				<td>timestamp</td>
			</tr>
			<tr>
				<td>lastModifiedBy</td>
				<td>UUID string</td>
			</tr>
			<tr>
				<td>lastModifiedDate</td>
				<td>timestamp</td>
			</tr>
		</tbody>
	</table>
	<h2 id="film-actors">Film Actors</h2>
	<p>Information on physical persons with roles in films on record</p>
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Action</th>
				<th>Method</th>
				<th>URL</th>
				<th>Request body</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>Create</td>
				<td>POST</td>
				<td>http://localhost:8080/calipso/api/rest/filmActors</td>
				<td>JSON</td>
			</tr>
			<tr>
				<td>Update</td>
				<td>PUT</td>
				<td>http://localhost:8080/calipso/api/rest/filmActors</td>
				<td>JSON</td>
			</tr>
			<tr>
				<td>Search</td>
				<td>GET</td>
				<td>http://localhost:8080/calipso/api/rest/filmActors?:paramN=valueN</td>
				<td>ignored</td>
			</tr>
		</tbody>
	</table>
	<p>Search parameters:</p>
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Name</th>
				<th>Type</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>id</td>
				<td>UUID string</td>
			</tr>
			<tr>
				<td>firstName</td>
				<td>string (‘%’ is a “like” wildcard)</td>
			</tr>
			<tr>
				<td>lastName</td>
				<td>string (‘%’ is a “like” wildcard)</td>
			</tr>
			<tr>
				<td>createdBy</td>
				<td>UUID string</td>
			</tr>
			<tr>
				<td>createdDate</td>
				<td>timestamp</td>
			</tr>
			<tr>
				<td>lastModifiedBy</td>
				<td>UUID string</td>
			</tr>
			<tr>
				<td>lastModifiedDate</td>
				<td>timestamp</td>
			</tr>
		</tbody>
	</table>
	<h2 id="film-categories">Film Categories</h2>
	<p>Film categories (action, drama etc.).</p>
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Action</th>
				<th>Method</th>
				<th>URL</th>
				<th>Request body</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>Create</td>
				<td>POST</td>
				<td>http://localhost:8080/calipso/api/rest/filmCategories</td>
				<td>JSON</td>
			</tr>
			<tr>
				<td>Update</td>
				<td>PUT</td>
				<td>http://localhost:8080/calipso/api/rest/filmCategories</td>
				<td>JSON</td>
			</tr>
			<tr>
				<td>Search</td>
				<td>GET</td>
				<td>http://localhost:8080/calipso/api/rest/filmCategories?:paramN=valueN</td>
				<td>ignored</td>
			</tr>
		</tbody>
	</table>
	<p>Search parameters:</p>
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Name</th>
				<th>Type</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>id</td>
				<td>UUID string</td>
			</tr>
			<tr>
				<td>name</td>
				<td>string (‘%’ is a “like” wildcard)</td>
			</tr>
			<tr>
				<td>parent</td>
				<td>UUID string</td>
			</tr>
			<tr>
				<td>createdBy</td>
				<td>UUID string</td>
			</tr>
			<tr>
				<td>createdDate</td>
				<td>timestamp</td>
			</tr>
			<tr>
				<td>lastModifiedBy</td>
				<td>UUID string</td>
			</tr>
			<tr>
				<td>lastModifiedDate</td>
				<td>timestamp</td>
			</tr>
		</tbody>
	</table>
	<h2 id="film-pricing-strategies">Film Pricing Strategies</h2>
	<p>The store has three types of films.</p>
	<ul>
		<li>New releases – Price is times number of days rented.</li>
		<li>Regular films – Price is for the fist 3 days and then times the number of days over 3.</li>
		<li>Old film - Price is for the fist 5 days and then times the number of days over 5</li>
	</ul>
	<p>This is modeled in three properties:</p>
	<dl>
		<dt>
			<code>initialPrice</code>
		</dt>
		<dd>the price to rent a film</dd>
		<dt>
			<code>daysFree</code>
		</dt>
		<dd>
			the number of days included in the
			<code>initialPrice</code>
		</dd>
		<dt>
			<code>dailyPrice</code>
		</dt>
		<dd>
			the price per day (not counting
			<code>daysFree</code>
			)
		</dd>
	</dl>
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Action</th>
				<th>Method</th>
				<th>URL</th>
				<th>Request body</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>Create</td>
				<td>POST</td>
				<td>http://localhost:8080/calipso/api/rest/filmPricingStrategies</td>
				<td>JSON</td>
			</tr>
			<tr>
				<td>Update</td>
				<td>PUT</td>
				<td>http://localhost:8080/calipso/api/rest/filmPricingStrategies</td>
				<td>JSON</td>
			</tr>
			<tr>
				<td>Search</td>
				<td>GET</td>
				<td>http://localhost:8080/calipso/api/rest/filmPricingStrategies?:paramN=valueN</td>
				<td>ignored</td>
			</tr>
		</tbody>
	</table>
	<p>Search parameters:</p>
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Name</th>
				<th>Type</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>id</td>
				<td>UUID string</td>
			</tr>
			<tr>
				<td>initialPrice</td>
				<td>float</td>
			</tr>
			<tr>
				<td>daysFree</td>
				<td>int</td>
			</tr>
			<tr>
				<td>dailyPrice</td>
				<td>float</td>
			</tr>
			<tr>
				<td>createdBy</td>
				<td>UUID string</td>
			</tr>
			<tr>
				<td>createdDate</td>
				<td>timestamp</td>
			</tr>
			<tr>
				<td>lastModifiedBy</td>
				<td>UUID string</td>
			</tr>
			<tr>
				<td>lastModifiedDate</td>
				<td>timestamp</td>
			</tr>
		</tbody>
	</table>
	<h2 id="rentals">Rentals</h2>
	<p>Inventory rentals</p>
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Action</th>
				<th>Method</th>
				<th>URL</th>
				<th>Request body</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>Create</td>
				<td>POST</td>
				<td>http://localhost:8080/calipso/api/rest/rentals</td>
				<td>JSON</td>
			</tr>
			<tr>
				<td>Update</td>
				<td>PUT</td>
				<td>http://localhost:8080/calipso/api/rest/rentals</td>
				<td>JSON</td>
			</tr>
			<tr>
				<td>Search</td>
				<td>GET</td>
				<td>http://localhost:8080/calipso/api/rest/rentals?:paramN=valueN</td>
				<td>ignored</td>
			</tr>
		</tbody>
	</table>
	<p>Search parameters:</p>
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Name</th>
				<th>Type</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>id</td>
				<td>UUID string</td>
			</tr>
			<tr>
				<td>customer</td>
				<td>UUID string</td>
			</tr>
			</tr>
				<td>customer.[any customer property name]</td>
				<td>according to the property name</td>
			</tr>
			<tr>
				<td>inventory</td>
				<td>UUID string</td>
			</tr>
			</tr>
				<td>inventory.[any inventory property name]</td>
				<td>according to the property name</td>
			</tr>
			<tr>
				<td>createdBy</td>
				<td>UUID string</td>
			</tr>
			<tr>
				<td>rentalDate</td>
				<td>timestamp</td>
			</tr>
			<tr>
				<td>returnDate</td>
				<td>timestamp</td>
			</tr>
			<tr>
				<td>createdDate</td>
				<td>timestamp</td>
			</tr>
			<tr>
				<td>lastModifiedBy</td>
				<td>UUID string</td>
			</tr>
			<tr>
				<td>lastModifiedDate</td>
				<td>timestamp</td>
			</tr>
		</tbody>
	</table>
</section>



<section class="bs-docs-section">
	<h1 id="license" class="page-header">License</h1>
	<p><img src="{{ site.baseurl }}/assets/images/agplv3-155x51.png" style="float:right" />Calipso Hub DVD Rental is distributed under the <a href="https://www.gnu.org/licenses/agpl-3.0.html">GNU Affero General Public License</a></p>
</section>
